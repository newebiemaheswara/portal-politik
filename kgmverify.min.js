const kgmverify={publisher:"",schedules:[2,24,168,672],secureSameSite:!0,development:!1,styleCss:"https://asset.kompas.com/data/2024/08/15/kgmverify/css/kgm-verify.min.css",init:function(e="kompascom"){this.publisher=e,"kompas.com"!=location.hostname.split(".").reverse().splice(0,2).reverse().join(".")&&document.body.classList.add("theme-light");const t=this.createHTMLElement("script",{type:"text/javascript",src:"https://asset.kompas.com/data/2023/11/09/kgmverify/js/main-verify-v2.min.js"},null);"kompascom"!==e?this.loadCSS(this.styleCss).then(()=>{document.body.appendChild(this.genElementVerify()),document.body.appendChild(t),document.body.appendChild(this.genElementVerifyFinished()),this.checkVerify(),document.querySelector("#birth").addEventListener("input",this.toggleButtonState),document.querySelector("#gender").addEventListener("change",this.toggleButtonState),document.querySelector("#handphone").addEventListener("input",this.toggleButtonState)}):(document.body.appendChild(this.genElementVerify()),document.body.appendChild(t),document.body.appendChild(this.genElementVerifyFinished()),this.checkVerify(),document.querySelector("#birth").addEventListener("input",this.toggleButtonState),document.querySelector("#gender").addEventListener("change",this.toggleButtonState),document.querySelector("#handphone").addEventListener("input",this.toggleButtonState))},loadCSS:function(e){return new Promise(function(t,i){var n=document.createElement("link");n.rel="stylesheet",n.href=e,n.onload=t,n.onerror=i,document.body.appendChild(n)})},genElementVerify:function(){return this.createElementFromHTML('\n            <section class="kgmModal -full -hide --v2" id="kgmModal-verify-v2">\n                <div class="kgmModal-block">\n                    <button type="button" onclick="kgmverify.reminderVerify()"\n                        class="kgmModal-close"></button>\n                    <form>\n                        <div class="kgmModal-header">\n                            <div class="kgmModal-img">\n                                <img src="https://asset.kompas.com/data/2023/11/09/kgmverify/images/icon-verification.png"\n                                    alt="Verifikasi akun KG Media ID">\n                            </div>\n                            <div class="kgmModal-header-inner">\n                                <div class="kgmModal-title">Verifikasi Akun</div>\n                                <div class="kgmModal-id"></div>\n                            </div>\n                        </div>\n                        <div class="kgmModal-body">\n                            <div class="kgmModal-alert">\n                                <div class="kgmModal-alert-icon">\n                                    <span class="icon-alert"></span>\n                                </div>\n                                <div class="kgmModal-alert-info">Proteksi akunmu dari aktivitas yang tidak kamu lakukan.</div>\n                            </div>\n                            <div class="form-main">\n                                <div class="form-row form-input">\n                                    <label for="gender">Gender</label>\n                                    <div class="form-select" data-placeholder="Pilih Gender">\n                                        <select id="gender" name="gender" class=" " required="required">\n                                            <option value="0" selected="selected" disabled="disabled">Pilih Gender</option>\n                                            <option value="l">Pria</option>\n                                            <option value="p">Wanita</option>\n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="form-row form-input" id="js-datepicker-container">\n                                    <label for="birth">Tanggal Lahir</label>\n                                    <input type="text" id="birth" name="birth" class=" js-datepicker"\n                                        placeholder="Pilih Tanggal Lahir" required="required" readonly="readonly">\n                                </div>\n                                <div class="form-row form-input">\n                                    <label for="handphone">Nomor Telepon <span>(opsional)</span></label>\n                                    <input type="tel" id="handphone" name="handphone" class="" placeholder="xxxx-xxxx-xxxx">\n                                </div>\n                            </div>\n                            <div class="kgmModal-info">\n                                Data akan digunakan untuk tujuan verifikasi sesuai <a href="https://www.kgmedia.id/legal-privacy-id"\n                                    target="_blank">Kebijakan Data Pribadi KG Media</a>.\n                            </div>\n                        </div>\n                        <div class="kgmModal-footer">\n                            <div class="form-row">\n                                <button name="verify-btn-later" id="verify-btn-later" type="button" class="button"\n                                    onclick="kgmverify.reminderVerify()">Ingatkan\n                                    Nanti</button>\n                            </div>\n                            <div class="form-row">\n                                <button name="verify-btn-send" id="verify-btn-send" class="button -disabled" disabled="disabled" type="button"\n                                    onclick="kgmverify.updateProfile()">Simpan</button>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n            </section>\n        ')},genElementVerifyFinished:function(){return this.createElementFromHTML('\n            <section class="kgmModal -full -hide --v2" id="kgmModal-verify-v2-finish">\n                <div class="kgmModal-block">\n                    <button type="button" onclick="document.getElementById(\'kgmModal-verify-v2-finish\').style.display=\'none\';return false;" class="kgmModal-close"></button>\n                    <div class="kgmModal-body">\n                        <div class="kgmModal-finish-block">\n                            <div class="kgmModal-finish-icon -success"></div>\n                            <div class="kgmModal-finish-title">Verifikasi Akun Berhasil</div>\n                            <div class="kgmModal-finish-email"></div>\n                        </div>\n                    </div>\n                    <div class="kgmModal-footer">\n                        <div class="form-row">\n                            <button name="verify-btn-finish" id="verify-btn-finish" class="button -primary" onclick="document.getElementById(\'kgmModal-verify-v2-finish\').style.display=\'none\';return false;">OK</button>\n                        </div>\n                    </div>\n                </div>\n            </section>\n        ')},createElementFromHTML:function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},createHTMLElement(e,t,i){var n=document.createElement(e);for(var s in t)n.setAttribute(s,t[s]);return i&&i.length&&i.forEach(function(e){n.appendChild(e)}),n},timeout:"",toggleButtonState:function(){const e=document.querySelector("#kgmModal-verify-v2 button[name=verify-btn-send]");if(e){const t=document.querySelector("#gender").value,i=document.querySelector("#birth").value.trim(),n=document.querySelector("#handphone");if(""!==i&&"0"!==t)if(""!==n.value)clearTimeout(kgmverify.timeout),kgmverify.timeout=setTimeout(function(){const t=n.parentElement,i=document.querySelector("#phone-message"),s=new RegExp("^[0-9]{8,}$").test(n.value);if(i&&t.removeChild(i),s)e.classList.remove("-disabled"),e.removeAttribute("disabled"),e.classList.add("-primary");else{const i=kgmverify.createHTMLElement("span",null,null);i.id="phone-message",i.style.fontSize="10px",i.style.color="red",i.textContent="Nomor telepon tidak valid!",t.appendChild(i),e.classList.contains("-disabled")||(e.classList.add("-disabled"),e.setAttribute("disabled","disabled"),e.classList.remove("-primary"))}},1e3);else{const t=document.querySelector("#phone-message");t&&(clearTimeout(kgmverify.timeout),t.remove()),e.classList.remove("-disabled"),e.removeAttribute("disabled"),e.classList.add("-primary")}else e.classList.add("-disabled"),e.setAttribute("disabled","disabled"),e.classList.remove("-primary")}},checkVerify:function(){let e=this.getCookie("__kgmverify");if(e)if((e=JSON.parse(atob(e))).kmps_usrid==this.getCookie("kmps_usrid")){if("INCOMPLETE"===e.status){let t=e.show,i=new Date;if(i=i.getTime(),void 0!==t){i>new Date(t).getTime()&&this.verify()}else this.verify()}}else this.verify();else this.verify()},verify:async function(){try{let e="COMPLETED";const t=this.getCookie("kmp_uid"),i=this.getCookie("lgn_w")||this.getCookie("LoginWith");if(void 0===t||void 0===i)return;const n=await fetch(`https://apis.kompas.com/api/sso_new/user/detail?token=${t}&loginwith=${i}`,{method:"GET",timeout:0});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const s=await n.json();if(s.status){(void 0===s.user.gender||void 0===s.user.birthdate||""===s.user.gender||""===s.user.birthdate||this.development)&&(document.querySelector("#kgmModal-verify-v2 .kgmModal-id").innerHTML=s.user.email,document.querySelector("#kgmModal-verify-v2-finish .kgmModal-finish-email").innerHTML=s.user.email,document.querySelector("#kgmModal-verify-v2").classList.remove("-hide"),e="INCOMPLETE");let t=this.getCookie("__kgmverify");t?((t=JSON.parse(atob(t))).kmps_usrid!=this.getCookie("kmps_usrid")&&(delete t.count_close,delete t.show),t.status=e,t.kmps_usrid=this.getCookie("kmps_usrid"),this.setCookie("__kgmverify",btoa(JSON.stringify(t)),8760)):this.setCookie("__kgmverify",btoa(JSON.stringify({status:e,kmps_usrid:this.getCookie("kmps_usrid")})),8760)}}catch(e){throw console.error("An error occurred:",e),e}},reminderVerify:function(){let e=this.getCookie("__kgmverify");if(e){let t=(e=JSON.parse(atob(e))).count_close;void 0!==t?(t=parseInt(t),e.count_close=t+1,t>=this.schedules.length?e.show=this.setSchedule(this.schedules[this.schedules.length-1]):e.show=this.setSchedule(this.schedules[t])):(e.count_close=1,e.show=this.setSchedule(this.schedules[0])),this.setCookie("__kgmverify",btoa(JSON.stringify(e)),8760)}document.getElementById("kgmModal-verify-v2").classList.add("-hide")},updateProfile:async function(){try{let e=document.querySelector("#birth").value,t=document.querySelector("#gender").value,i=document.querySelector("#handphone").value;const n={method:"POST",body:JSON.stringify({token_type:"XKMPSS",token:this.getCookie("XKMPSS"),birthdate:e.split("/").reverse().join("-"),gender:t,phone_number:i,publisher:this.publisher,trigger:"verifikasi account"})},s=await fetch("https://apis.kompas.com/api/sso_new/edit-profile-custom",n);if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);if((await s.json()).status){document.querySelector("#kgmModal-verify-v2").style.display="none",document.querySelector("#kgmModal-verify-v2-finish").classList.remove("-hide");let e=this.getCookie("__kgmverify");e&&((e=JSON.parse(atob(e))).status="COMPLETED",this.setCookie("__kgmverify",btoa(JSON.stringify(e)),8760))}}catch(e){throw console.error("An error occurred:",e),e}},getCookie:function(e){e+="=";for(var t=decodeURIComponent(document.cookie).split(";"),i=0;i<t.length;i++){for(var n=t[i];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}},setCookie:function(e,t,i){return new Promise(n=>{var s=new Date,o=window.location.hostname.split(".").slice(-2).join(".");s.setTime(s.getTime()+60*i*60*1e3);var r="expires="+s.toUTCString();this.secureSameSite?document.cookie=`${e}=${t};${r};domain=${o};path=/;secure;SameSite=None`:document.cookie=`${e}=${t};${r};domain=${o};path=/;`,n(!0)})},setSchedule:function(e){const t=new Date;return t.setTime(t.getTime()+60*e*60*1e3),t.toISOString()}};function KgmVerifyWidget(e){if(e&&e.publisher){const t=e.publisher;let i=!1;void 0!==e.secureSameSite&&(kgmverify.secureSameSite=e.secureSameSite),void 0!==e.development&&(kgmverify.development=e.development),void 0!==e.schedules&&(Array.isArray(e.schedules)?kgmverify.schedules=e.schedules:(console.error('Kgmverify Error: Data "schedules" harus berupa array'),i=!0)),void 0!==e.styleCss&&(kgmverify.styleCss=e.styleCss),i||kgmverify.init(t)}else console.error('Kgmverify Error: Objek options harus memiliki properti "publisher"')}